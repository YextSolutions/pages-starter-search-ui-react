import { getBundlePaths, statSync } from "./bundleValidatorHelper.js";
const PLUGIN_FILESIZE_LIMIT = 10;
const PLUGIN_TOTAL_FILESIZE_LIMIT = 10;
const validateBundles = (projectStructure) => {
  const bundlePaths = getBundlePaths(projectStructure);
  let sizeOfAllBundles = 0;
  bundlePaths.forEach((bundlePath) => {
    sizeOfAllBundles += validateFilesize(bundlePath);
  });
  validateTotalSourceSize(sizeOfAllBundles);
};
const validateFilesize = (serverBundlePath) => {
  const stats = statSync(serverBundlePath);
  if (stats.size / (1024 * 1024) > PLUGIN_FILESIZE_LIMIT) {
    throw `Bundled file ${serverBundlePath} exceeds max size of ${PLUGIN_FILESIZE_LIMIT} MB`;
  }
  return stats.size;
};
const validateTotalSourceSize = (totalSizeInBytes) => {
  if (totalSizeInBytes / (1024 * 1024) > PLUGIN_TOTAL_FILESIZE_LIMIT) {
    throw `The total size of all bundles exceeds the max size of ${PLUGIN_TOTAL_FILESIZE_LIMIT} MB`;
  }
};
export {
  validateBundles
};
